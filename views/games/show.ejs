<%- include('../partials/header') %>
<section id="games-detail">
    <div>Title: </div>
    <div><%= game.title %></div>
    <div>Release Year: </div>
    <div><%= game.released %></div>
    <div>Developer:</div>
    <ul>
      <%- game.developer.map(g => 
        `<li>${g.studio} <small>${g.director}</small></li>`
      ).join('') %>
    </ul>
    <form id="add-game-developer" action="/games/<%= game._id %>/developers" method="POST">
        <select name="developerId">
          <%- developers.map(d => 
            `<option value="${d._id}">${d.studio} Head Designer:${d.director}</option>`
          ).join('') %>
        </select>
        <button type="submit">Add Developer</button>
    </form>
    <% if ((user && user._id)) { %>
    <form id="add-to-backlog" action="/games/<%= game._id %>/gamers" method="POST">
        <button name = "backlog" value =`"${game._id}"` >Add to Backlog</button>
    </form>
    <% } %>
    <%if (isIncluded) {%>
        <form id="add-to-progress" action="/games/<%= game._id %>/progress" method="POST">
        <textarea name="progress"></textarea>
        <button type="submit">Add Progress</button>
    </form>
    <% } %>
    <%if (isIncluded) {%>
        <% gamer.backlog.forEach(function(b,bidx){ %>
            <% if(b.games == game.id){ %>
            <% b.progress.forEach(function(p,idx){ %> 
                <tr>
                    <td><%=b.progress[idx]%></td>
                </tr>
                <% }); %> 
            <% } %> 
        <%});%>
    <% }; %>
   
<%- include('../partials/footer') %>